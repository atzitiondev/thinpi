#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f src/thinpi/tpupdate/tpupdate 
#endif

static  char data [] = 
#define      rlax_z	1
#define      rlax	((&data[0]))
	"\143"
#define      text_z	764
#define      text	((&data[164]))
	"\140\116\202\320\232\063\271\217\123\047\042\021\066\221\313\142"
	"\303\046\343\064\250\166\066\376\103\354\043\175\274\375\020\035"
	"\114\222\355\346\306\247\166\031\316\230\053\005\052\367\150\356"
	"\036\113\042\306\302\131\305\005\105\350\203\002\346\223\037\062"
	"\046\015\031\355\264\220\006\203\051\062\210\124\052\361\102\110"
	"\075\145\017\377\276\324\005\003\275\210\006\244\034\045\327\102"
	"\062\360\057\346\201\066\151\252\151\362\376\223\343\101\334\040"
	"\246\354\040\144\300\046\150\176\256\156\042\312\224\371\015\306"
	"\352\075\255\154\164\027\027\335\011\025\161\355\127\116\016\375"
	"\072\057\142\372\125\313\171\003\071\234\316\315\226\334\224\201"
	"\032\101\355\303\245\063\005\261\172\137\115\136\153\364\315\232"
	"\322\373\114\251\104\202\137\136\260\375\220\347\246\271\336\206"
	"\216\073\064\163\317\155\334\157\124\175\310\157\316\245\327\043"
	"\275\037\114\254\147\252\354\150\026\076\164\244\117\012\346\315"
	"\340\126\347\171\166\044\016\037\237\056\003\100\016\345\353\144"
	"\114\364\351\261\361\353\174\373\277\202\160\337\372\124\030\060"
	"\006\255\323\245\156\352\026\055\357\316\317\044\210\362\254\060"
	"\214\032\314\331\115\220\233\265\323\173\317\003\164\117\364\061"
	"\367\272\264\312\134\050\004\337\332\170\373\331\357\076\210\377"
	"\354\300\170\160\330\146\316\041\141\041\015\304\163\140\335\257"
	"\101\221\231\273\250\242\013\060\370\124\131\053\007\125\206\113"
	"\324\007\230\112\375\177\232\023\310\317\060\032\030\327\362\335"
	"\207\305\346\057\230\015\046\345\045\174\341\306\240\134\336\355"
	"\276\173\256\176\000\143\206\075\261\030\232\105\213\257\036\254"
	"\172\350\266\326\260\040\330\010\026\252\314\205\221\306\346\170"
	"\104\327\255\366\343\060\202\002\361\302\273\107\112\277\200\114"
	"\062\026\246\204\252\112\336\254\321\360\205\147\221\135\067\217"
	"\312\116\342\145\216\067\204\030\346\230\153\332\041\266\126\330"
	"\136\327\152\366\353\223\211\057\073\055\017\157\232\157\305\033"
	"\217\254\233\126\360\342\322\213\045\222\310\345\372\345\377\027"
	"\000\116\314\373\151\200\346\023\207\242\114\142\204\233\373\024"
	"\064\327\377\105\303\151\235\066\262\210\116\011\223\234\240\070"
	"\332\200\324\207\134\106\204\102\330\317\120\133\227\140\165\310"
	"\142\103\132\312\126\076\002\314\156\161\065\244\070\265\060\236"
	"\123\053\034\371\153\226\061\107\363\173\147\032\003\000\270\300"
	"\370\045\041\026\175\222\140\010\105\054\070\217\264\302\247\337"
	"\177\072\055\241\372\144\206\006\362\167\174\037\271\215\316\002"
	"\312\033\070\355\046\371\042\313\011\005\023\272\067\362\023\102"
	"\206\175\205\336\201\003\374\147\272\362\005\015\070\263\273\233"
	"\326\230\077\114\131\251\305\135\065\130\313\165\147\273\016\046"
	"\121\373\062\114\216\342\203\241\325\263\327\113\074\100\267\262"
	"\143\134\047\206\327\045\330\067\003\377\202\223\055\305\057\356"
	"\261\171\367\061\144\257\201\056\132\116\263\346\345\210\222\344"
	"\234\131\027\003\120\206\146\365\351\203\114\051\140\352\247\014"
	"\305\342\101\165\012\026\166\364\341\307\063\216\322\044\107\052"
	"\134\116\051\003\017\351\044\053\032\227\247\006\036\244\332\366"
	"\146\060\153\215\236\144\071\307\316\363\005\272\117\234\120\246"
	"\025\346\151\222\163\335\315\003\036\034\157\025\326\012\110\205"
	"\201\120\100\062\310\013\052\172\314\107\012\243\051\044\243\177"
	"\024\031\310\023\107\041\350\051\205\104\042\270\030\065\143\332"
	"\051\177\061\372\125\322\123\135\114\007\373\121\152\254\331\116"
	"\270\164\067\154\046\007\065\155\251\007\344\371\073\151\051\127"
	"\154\233\041\357\316\207\022\063\052\205\113\363\127\065\011\363"
	"\022\171\217\242\175\163\115\147\116\012\203\025\111\217\205\313"
	"\156\177\062\360\013\202\165\104\371\347\261\331\123\132\327\355"
	"\016\374\112\105\257\046\123\213\155\123\171\324\117\171\365\122"
	"\113\115\277\142\154\262\237\320\155\356\254\165\156\236\013\141"
	"\353\176\163\261\355\111\353\165\351\073\113\317\125\060\332\216"
	"\131\004\154\142\032\336\120\161\054\136\157\146\215\321\141\343"
	"\234\332\346\326\167\265\244\015\222\071\216\254\173\173\073\324"
	"\200\247\067\232\205\207\014\262\346\173\030\164\115\171\127\352"
	"\124\076\300\313\364\145\330\206\236\147\062\031\342\155\355\142"
	"\025\044\375\233\254\011\115\222\204\146\007\321\340\136\274\064"
	"\234\175\000\221\342\331\027\201\100\111\232\043\267\210\205\315"
	"\255\203\150\131\214\266\354\020\034\363\342\375\122"
#define      msg2_z	19
#define      msg2	((&data[1038]))
	"\203\057\340\362\275\315\251\000\347\121\360\321\070\265\276\336"
	"\325\174\173\033\062\200\376"
#define      pswd_z	256
#define      pswd	((&data[1099]))
	"\115\341\032\160\230\242\366\146\120\171\316\252\005\205\226\026"
	"\241\212\371\236\334\230\321\313\264\003\113\262\020\343\062\135"
	"\304\114\315\135\357\304\044\116\075\340\042\127\052\106\205\242"
	"\232\162\207\301\355\320\105\061\332\013\237\026\070\113\222\120"
	"\210\002\026\233\260\073\351\356\034\014\106\107\122\313\351\354"
	"\075\161\256\052\102\363\133\034\377\373\063\067\106\305\210\317"
	"\310\237\152\170\333\123\147\370\137\255\077\262\170\051\236\266"
	"\232\114\340\334\100\074\371\100\070\054\170\176\362\001\115\272"
	"\240\270\063\174\013\232\164\153\107\263\035\300\334\274\166\167"
	"\011\127\123\111\224\115\212\314\172\002\113\154\003\231\046\244"
	"\121\131\040\134\364\225\310\073\110\345\374\045\241\162\234\252"
	"\312\360\364\136\075\176\052\270\201\165\044\205\016\112\051\137"
	"\244\112\274\230\337\204\324\050\152\320\115\014\103\351\267\015"
	"\332\253\154\030\052\227\320\254\014\364\061\033\077\133\173\344"
	"\245\070\175\205\275\121\255\047\042\373\063\146\345\353\164\277"
	"\226\341\330\301\170\250\156\205\235\237\241\335\373\034\301\240"
	"\124\077\046\022\221\324\071\264\317\155\032\264\130\217\164\357"
	"\160\114\261\350\364\037\156\222\276\017\157\271\053\061\132\200"
	"\160\201\222\001\125\314\303\100\075\222\352\103\027\201\132\271"
	"\013\123\130\350\354\051\263\240\055\377\123\075\342\205\232\246"
	"\321\150\004\301\054\307"
#define      msg1_z	65
#define      msg1	((&data[1394]))
	"\353\256\161\155\010\052\170\215\303\015\374\103\123\305\327\365"
	"\352\301\120\030\176\244\137\342\075\025\372\262\234\245\354\061"
	"\200\047\110\112\251\035\360\013\350\127\034\223\270\150\105\014"
	"\153\362\076\111\202\144\257\234\251\033\063\356\113\047\001\232"
	"\367\353\372\003\016\370\144\275\134\202\140\110\253"
#define      date_z	1
#define      date	((&data[1464]))
	"\101"
#define      shll_z	10
#define      shll	((&data[1465]))
	"\356\102\031\324\167\166\001\335\272\007"
#define      chk2_z	19
#define      chk2	((&data[1478]))
	"\236\223\031\205\070\135\177\227\070\176\251\302\367\066\151\144"
	"\160\037\361\216\121\370\242\124\105"
#define      lsto_z	1
#define      lsto	((&data[1500]))
	"\103"
#define      opts_z	1
#define      opts	((&data[1501]))
	"\033"
#define      inlo_z	3
#define      inlo	((&data[1502]))
	"\131\221\153"
#define      xecc_z	15
#define      xecc	((&data[1505]))
	"\065\104\370\046\273\025\152\013\373\310\165\162\271\246\305\341"
	"\210\014"
#define      chk1_z	22
#define      chk1	((&data[1526]))
	"\146\262\061\200\050\217\150\171\064\050\000\033\007\315\212\164"
	"\022\076\014\257\031\255\334\141\052\174\251\363\055\107"
#define      tst1_z	22
#define      tst1	((&data[1554]))
	"\333\004\006\174\212\332\175\367\132\176\277\255\136\200\207\233"
	"\360\123\103\032\256\175\336\214\123\061\075\026"
#define      tst2_z	19
#define      tst2	((&data[1584]))
	"\042\002\252\013\272\001\045\064\213\205\232\222\115\035\026\235"
	"\151\070\040\265\330\376\112"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
